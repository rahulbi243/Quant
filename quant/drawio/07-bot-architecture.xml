<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36" version="29.5.1">
  <diagram id="bot-architecture" name="Bot Architecture">
    <mxGraphModel dx="603" dy="408" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;fontColor=#1a1a2e;" value="Prediction Market LLM Trading Bot — Architecture &amp; Flow" vertex="1">
          <mxGeometry height="40" width="1200" x="220" y="20" as="geometry" />
        </mxCell>
        <mxCell id="label-scheduler" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#666666;" value="ORCHESTRATOR" vertex="1">
          <mxGeometry height="30" width="120" x="30" y="80" as="geometry" />
        </mxCell>
        <mxCell id="label-exchange" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#666666;" value="EXCHANGES" vertex="1">
          <mxGeometry height="30" width="120" x="30" y="190" as="geometry" />
        </mxCell>
        <mxCell id="label-intelligence" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#666666;" value="INTELLIGENCE" vertex="1">
          <mxGeometry height="30" width="120" x="30" y="370" as="geometry" />
        </mxCell>
        <mxCell id="label-trading" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#666666;" value="TRADING" vertex="1">
          <mxGeometry height="30" width="120" x="30" y="580" as="geometry" />
        </mxCell>
        <mxCell id="label-learning" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#666666;" value="SELF-IMPROVEMENT" vertex="1">
          <mxGeometry height="40" width="120" x="30" y="730" as="geometry" />
        </mxCell>
        <mxCell id="label-db" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#666666;" value="PERSISTENCE" vertex="1">
          <mxGeometry height="30" width="120" x="30" y="930" as="geometry" />
        </mxCell>
        <mxCell id="runpy" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;fontSize=11;" value="run.py&#xa;(entry point)" vertex="1">
          <mxGeometry height="45" width="140" x="120" as="geometry" />
        </mxCell>
        <mxCell id="bg-scheduler" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#d6b656;opacity=30;" value="" vertex="1">
          <mxGeometry height="60" width="1270" x="160" y="130" as="geometry" />
        </mxCell>
        <mxCell id="job-scan" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" value="scan_markets()&#xa;every 4h" vertex="1">
          <mxGeometry height="40" width="130" x="170" y="140" as="geometry" />
        </mxCell>
        <mxCell id="job-price" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" value="update_prices()&#xa;every 30m" vertex="1">
          <mxGeometry height="40" width="130" x="320" y="140" as="geometry" />
        </mxCell>
        <mxCell id="job-resolve" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" value="check_resolutions()&#xa;every 1h" vertex="1">
          <mxGeometry height="40" width="130" x="470" y="140" as="geometry" />
        </mxCell>
        <mxCell id="job-forecast" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" value="run_forecasts()&#xa;every 4h" vertex="1">
          <mxGeometry height="40" width="130" x="620" y="140" as="geometry" />
        </mxCell>
        <mxCell id="job-selfimprove" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" value="self_improvement()&#xa;daily 6am" vertex="1">
          <mxGeometry height="40" width="130" x="770" y="140" as="geometry" />
        </mxCell>
        <mxCell id="job-tournament" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" value="prompt_tournament()&#xa;weekly Mon" vertex="1">
          <mxGeometry height="40" width="130" x="920" y="140" as="geometry" />
        </mxCell>
        <mxCell id="job-loadstate" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" value="load_state()&#xa;on start" vertex="1">
          <mxGeometry height="40" width="130" x="1070" y="140" as="geometry" />
        </mxCell>
        <mxCell id="e-run-sched" edge="1" parent="1" source="runpy" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.15;entryY=0;entryDx=0;entryDy=0;strokeColor=#6c8ebf;" target="job-scan">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bg-exchange" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8f0ff;strokeColor=#9673a6;opacity=30;" value="" vertex="1">
          <mxGeometry height="170" width="1270" x="160" y="200" as="geometry" />
        </mxCell>
        <mxCell id="poly" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=1;" value="PolymarketClient&#xa;(py-clob-client)" vertex="1">
          <mxGeometry height="50" width="160" x="220" y="215" as="geometry" />
        </mxCell>
        <mxCell id="poly-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="• CLOB binary markets&#xa;• Min $10k vol, &gt;48h close&#xa;• YES price (0-1)&#xa;• Paper: bypass signing" vertex="1">
          <mxGeometry height="70" width="160" x="220" y="270" as="geometry" />
        </mxCell>
        <mxCell id="kalshi" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=1;" value="KalshiClient&#xa;(REST API v2)" vertex="1">
          <mxGeometry height="50" width="160" x="410" y="215" as="geometry" />
        </mxCell>
        <mxCell id="kalshi-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="• RSA-signed requests&#xa;• Binary yes/no markets&#xa;• Yes mid-price / 100&#xa;• Paper: skip submission" vertex="1">
          <mxGeometry height="70" width="160" x="410" y="270" as="geometry" />
        </mxCell>
        <mxCell id="scanner" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9673a6;strokeColor=#6d4c7a;fontColor=#ffffff;fontSize=10;fontStyle=1;" value="Scanner&#xa;(scan + dedup + prices)" vertex="1">
          <mxGeometry height="50" width="180" x="640" y="215" as="geometry" />
        </mxCell>
        <mxCell id="scanner-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="• Parallel scan both exchanges&#xa;• Fuzzy dedup (thefuzz ≥85)&#xa;• Upsert to markets table&#xa;• Dedup group links arb pairs" vertex="1">
          <mxGeometry height="70" width="180" x="640" y="270" as="geometry" />
        </mxCell>
        <mxCell id="e-poly-scan" edge="1" parent="1" source="poly" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#9673a6;" target="scanner">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-kalshi-scan" edge="1" parent="1" source="kalshi" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#9673a6;" target="scanner">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-jobscan-scanner" edge="1" parent="1" source="job-scan" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6b656;dashed=1;" target="scanner">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-jobprice-scanner" edge="1" parent="1" source="job-price" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6b656;dashed=1;" target="scanner">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="385" y="185" />
              <mxPoint x="730" y="185" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bg-intel" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f0f7ee;strokeColor=#82b366;opacity=30;" value="" vertex="1">
          <mxGeometry height="190" width="1270" x="160" y="380" as="geometry" />
        </mxCell>
        <mxCell id="classifier" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;fontStyle=1;" value="Classifier" vertex="1">
          <mxGeometry height="40" width="130" x="175" y="395" as="geometry" />
        </mxCell>
        <mxCell id="classifier-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="6 domains (Lossfunk order):&#xa;geopolitics &gt; politics &gt;&#xa;technology &gt; entertainment&#xa;&gt; finance &gt; sports&#xa;Uses Haiku (cheap)" vertex="1">
          <mxGeometry height="90" width="130" x="175" y="440" as="geometry" />
        </mxCell>
        <mxCell id="news" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;fontStyle=1;" value="News" vertex="1">
          <mxGeometry height="40" width="130" x="330" y="395" as="geometry" />
        </mxCell>
        <mxCell id="news-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="Guard 1: recency bias note&#xa;Guard 2: [SPECULATIVE] tag&#xa;Guard 3: definition terms&#xa;&#xa;⚠ entertainment/technology:&#xa;  news DISABLED (hurts acc.)" vertex="1">
          <mxGeometry height="90" width="130" x="330" y="440" as="geometry" />
        </mxCell>
        <mxCell id="forecaster" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;fontStyle=1;" value="Forecaster" vertex="1">
          <mxGeometry height="40" width="130" x="485" y="395" as="geometry" />
        </mxCell>
        <mxCell id="forecaster-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="Parallel asyncio.gather():&#xa;• claude-sonnet-4-6&#xa;• gpt-4.1&#xa;• deepseek-chat&#xa;Logprobs → entropy" vertex="1">
          <mxGeometry height="90" width="130" x="485" y="440" as="geometry" />
        </mxCell>
        <mxCell id="entropy" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;fontStyle=1;" value="Entropy" vertex="1">
          <mxGeometry height="40" width="130" x="640" y="395" as="geometry" />
        </mxCell>
        <mxCell id="entropy-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="Shannon H (bits)&#xa;Confidence tier:&#xa;  high  → H &lt; τ&#xa;  medium → H &lt; 1.5τ&#xa;  low   → H ≥ 1.5τ&#xa;τ per-domain adaptive" vertex="1">
          <mxGeometry height="90" width="130" x="640" y="440" as="geometry" />
        </mxCell>
        <mxCell id="ensemble" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#82b366;strokeColor=#5a8a47;fontColor=#ffffff;fontSize=10;fontStyle=1;" value="Ensemble" vertex="1">
          <mxGeometry height="40" width="130" x="800" y="395" as="geometry" />
        </mxCell>
        <mxCell id="ensemble-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="weight = model_wt × domain_wt&#xa;ens_prob = Σ(w·p) / Σw&#xa;ens_entropy = Σ(w·H) / Σw" vertex="1">
          <mxGeometry height="90" width="130" x="800" y="440" as="geometry" />
        </mxCell>
        <mxCell id="e-cls-news" edge="1" parent="1" source="classifier" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#82b366;" target="news">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-news-fore" edge="1" parent="1" source="news" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#82b366;" target="forecaster">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-fore-ent" edge="1" parent="1" source="forecaster" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#82b366;" target="entropy">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-ent-ens" edge="1" parent="1" source="entropy" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#82b366;" target="ensemble">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-scan-cls" edge="1" parent="1" source="scanner" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#9673a6;" target="classifier">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="730" y="360" />
              <mxPoint x="240" y="360" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e-jobfore-cls" edge="1" parent="1" source="job-forecast" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6b656;dashed=1;" target="classifier">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="685" y="355" />
              <mxPoint x="240" y="355" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bg-trading" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff0f0;strokeColor=#ae4132;opacity=30;" value="" vertex="1">
          <mxGeometry height="150" width="1270" x="160" y="580" as="geometry" />
        </mxCell>
        <mxCell id="edge-node" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#ae4132;fontSize=10;fontStyle=1;" value="Edge" vertex="1">
          <mxGeometry height="40" width="130" x="220" y="595" as="geometry" />
        </mxCell>
        <mxCell id="edge-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="edge = ens_prob − market_price&#xa;best side: YES if +edge, NO if −edge&#xa;Filter: edge &gt; 5%, tier==high, domain_wt&gt;0.5" vertex="1">
          <mxGeometry height="60" width="200" x="220" y="640" as="geometry" />
        </mxCell>
        <mxCell id="kelly-node" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#ae4132;fontSize=10;fontStyle=1;" value="Kelly Sizing" vertex="1">
          <mxGeometry height="40" width="130" x="440" y="595" as="geometry" />
        </mxCell>
        <mxCell id="kelly-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="f* = edge / (1 − price)&#xa;× 25% fractional Kelly&#xa;capped at 5% of bankroll" vertex="1">
          <mxGeometry height="60" width="130" x="440" y="640" as="geometry" />
        </mxCell>
        <mxCell id="executor" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ae4132;strokeColor=#761e14;fontColor=#ffffff;fontSize=10;fontStyle=1;" value="Executor" vertex="1">
          <mxGeometry height="40" width="130" x="660" y="595" as="geometry" />
        </mxCell>
        <mxCell id="executor-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="paper_mode=True:&#xa;  → write trades table (is_paper=1)&#xa;  → deduct virtual bankroll&#xa;paper_mode=False:&#xa;  → call exchange client" vertex="1">
          <mxGeometry height="70" width="160" x="660" y="640" as="geometry" />
        </mxCell>
        <mxCell id="portfolio" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#ae4132;fontSize=10;fontStyle=1;" value="Portfolio" vertex="1">
          <mxGeometry height="40" width="130" x="880" y="595" as="geometry" />
        </mxCell>
        <mxCell id="portfolio-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="Virtual bankroll tracking&#xa;Cash − open position value&#xa;Mark-to-market total value&#xa;Max 20 open positions" vertex="1">
          <mxGeometry height="60" width="130" x="880" y="640" as="geometry" />
        </mxCell>
        <mxCell id="e-ens-edge" edge="1" parent="1" source="ensemble" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#82b366;" target="edge-node">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="865" y="565" />
              <mxPoint x="285" y="565" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e-edge-kelly" edge="1" parent="1" source="edge-node" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#ae4132;" target="kelly-node">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-kelly-exec" edge="1" parent="1" source="kelly-node" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#ae4132;" target="executor">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-exec-port" edge="1" parent="1" source="executor" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#ae4132;" target="portfolio">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bg-learning" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff8e6;strokeColor=#d6a400;opacity=30;" value="" vertex="1">
          <mxGeometry height="180" width="1270" x="160" y="730" as="geometry" />
        </mxCell>
        <mxCell id="tracker" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6a400;fontSize=10;fontStyle=1;" value="Tracker" vertex="1">
          <mxGeometry height="40" width="130" x="180" y="745" as="geometry" />
        </mxCell>
        <mxCell id="tracker-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="Polls exchanges hourly&#xa;Finds resolved markets&#xa;Computes Brier=(pred−out)²&#xa;Writes outcomes table&#xa;Triggers calibration at N=10" vertex="1">
          <mxGeometry height="90" width="140" x="180" y="790" as="geometry" />
        </mxCell>
        <mxCell id="domain-cal" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6a400;fontSize=10;fontStyle=1;" value="Domain Calibrator" vertex="1">
          <mxGeometry height="40" width="150" x="360" y="745" as="geometry" />
        </mxCell>
        <mxCell id="domain-cal-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="Rolling Brier per (domain,model)&#xa;Brier &lt; 0.15 → weight 1.5&#xa;Brier 0.15-0.25 → weight 1.0-1.2&#xa;Brier &gt; 0.25 → weight 0.3&#xa;Alert if &gt; random baseline" vertex="1">
          <mxGeometry height="90" width="155" x="360" y="790" as="geometry" />
        </mxCell>
        <mxCell id="prompt-ev" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6a400;fontSize=10;fontStyle=1;" value="Prompt Evolver" vertex="1">
          <mxGeometry height="40" width="150" x="560" y="745" as="geometry" />
        </mxCell>
        <mxCell id="prompt-ev-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="v1-baseline / v2-cot (initial)&#xa;Random assignment per market&#xa;Weekly tournament (N≥20 trials)&#xa;Retire if Brier gap &gt; 0.05&#xa;LLM generates new variant" vertex="1">
          <mxGeometry height="90" width="155" x="560" y="790" as="geometry" />
        </mxCell>
        <mxCell id="thresh-adapt" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6a400;fontSize=10;fontStyle=1;" value="Threshold Adapter" vertex="1">
          <mxGeometry height="40" width="155" x="760" y="745" as="geometry" />
        </mxCell>
        <mxCell id="thresh-adapt-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="Prior τ = 4.0 bits&#xa;sep = P(correct|H&lt;τ) − P(correct|H≥τ)&#xa;sep &gt; 0.10 → tighten τ (−0.25)&#xa;sep &lt; 0.05 → widen τ (+0.25)&#xa;Per-domain thresholds in DB" vertex="1">
          <mxGeometry height="90" width="160" x="760" y="790" as="geometry" />
        </mxCell>
        <mxCell id="model-sel" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6a400;strokeColor=#a07800;fontColor=#ffffff;fontSize=10;fontStyle=1;" value="Model Selector" vertex="1">
          <mxGeometry height="40" width="150" x="970" y="745" as="geometry" />
        </mxCell>
        <mxCell id="model-sel-detail" parent="1" style="text;html=1;align=left;verticalAlign=top;fontSize=9;fillColor=none;strokeColor=none;" value="30-day rolling Brier per model&#xa;skill = 1 − (brier/0.25)&#xa;Normalise weights to sum=1&#xa;Kill switch: Brier &gt; 0.28 → w=0&#xa;Runs daily" vertex="1">
          <mxGeometry height="90" width="155" x="970" y="790" as="geometry" />
        </mxCell>
        <mxCell id="e-jobresolve-tracker" edge="1" parent="1" source="job-resolve" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6b656;dashed=1;" target="tracker">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="535" y="710" />
              <mxPoint x="245" y="710" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e-jobself-domcal" edge="1" parent="1" source="job-selfimprove" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6b656;dashed=1;" target="domain-cal">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="835" y="715" />
              <mxPoint x="435" y="715" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e-jobtour-promptev" edge="1" parent="1" source="job-tournament" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6b656;dashed=1;" target="prompt-ev">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="985" y="720" />
              <mxPoint x="635" y="720" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e-tracker-domcal" edge="1" parent="1" source="tracker" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6a400;" target="domain-cal">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-domcal-promptev" edge="1" parent="1" source="domain-cal" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6a400;" target="prompt-ev">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-promptev-threshadapt" edge="1" parent="1" source="prompt-ev" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6a400;" target="thresh-adapt">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-threshadapt-modsel" edge="1" parent="1" source="thresh-adapt" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6a400;" target="model-sel">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bg-db" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e8f4fd;strokeColor=#23769c;opacity=40;" value="" vertex="1">
          <mxGeometry height="100" width="1270" x="160" y="925" as="geometry" />
        </mxCell>
        <mxCell id="db-markets" parent="1" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=1;fillColor=#dae8fc;strokeColor=#23769c;fontSize=10;" value="markets" vertex="1">
          <mxGeometry height="80" width="130" x="175" y="935" as="geometry" />
        </mxCell>
        <mxCell id="db-forecasts" parent="1" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=1;fillColor=#dae8fc;strokeColor=#23769c;fontSize=10;" value="forecasts" vertex="1">
          <mxGeometry height="80" width="130" x="320" y="935" as="geometry" />
        </mxCell>
        <mxCell id="db-trades" parent="1" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=1;fillColor=#dae8fc;strokeColor=#23769c;fontSize=10;" value="trades" vertex="1">
          <mxGeometry height="80" width="130" x="465" y="935" as="geometry" />
        </mxCell>
        <mxCell id="db-outcomes" parent="1" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=1;fillColor=#dae8fc;strokeColor=#23769c;fontSize=10;" value="outcomes" vertex="1">
          <mxGeometry height="80" width="130" x="610" y="935" as="geometry" />
        </mxCell>
        <mxCell id="db-calibration" parent="1" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=1;fillColor=#dae8fc;strokeColor=#23769c;fontSize=10;" value="calibration_state" vertex="1">
          <mxGeometry height="80" width="150" x="755" y="935" as="geometry" />
        </mxCell>
        <mxCell id="db-prompts" parent="1" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=1;fillColor=#dae8fc;strokeColor=#23769c;fontSize=10;" value="prompt_experiments" vertex="1">
          <mxGeometry height="80" width="160" x="920" y="935" as="geometry" />
        </mxCell>
        <mxCell id="db-modelwts" parent="1" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=1;fillColor=#dae8fc;strokeColor=#23769c;fontSize=10;" value="model_weights" vertex="1">
          <mxGeometry height="80" width="140" x="1095" y="935" as="geometry" />
        </mxCell>
        <mxCell id="db-portfolio" parent="1" style="shape=table;startSize=30;container=0;collapsible=0;childLayout=tableLayout;fixedRows=1;rowLines=0;fontStyle=1;align=center;resizeLast=1;fillColor=#dae8fc;strokeColor=#23769c;fontSize=10;" value="portfolio_state&#xa;+ llm_costs" vertex="1">
          <mxGeometry height="80" width="150" x="1250" y="935" as="geometry" />
        </mxCell>
        <mxCell id="e-scan-dbmarkets" edge="1" parent="1" source="scanner" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#23769c;endArrow=ERmany;" target="db-markets">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-fore-dbforecasts" edge="1" parent="1" source="forecaster" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#23769c;endArrow=ERmany;" target="db-forecasts">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-exec-dbtrades" edge="1" parent="1" source="executor" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#23769c;endArrow=ERmany;" target="db-trades">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-tracker-dboutcomes" edge="1" parent="1" source="tracker" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#23769c;endArrow=ERmany;" target="db-outcomes">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-domcal-dbcal" edge="1" parent="1" source="domain-cal" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#23769c;endArrow=ERmany;" target="db-calibration">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-promptev-dbprompts" edge="1" parent="1" source="prompt-ev" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#23769c;endArrow=ERmany;" target="db-prompts">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-modsel-dbwts" edge="1" parent="1" source="model-sel" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#23769c;endArrow=ERmany;" target="db-modelwts">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-port-dbportfolio" edge="1" parent="1" source="portfolio" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#23769c;endArrow=ERmany;" target="db-portfolio">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e-modsel-fore" edge="1" parent="1" source="model-sel" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6a400;dashed=1;endArrow=open;fontSize=9;fontColor=#d6a400;" target="forecaster" value="updated model weights">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1200" y="755" />
              <mxPoint x="1200" y="490" />
              <mxPoint x="550" y="490" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e-domcal-ens" edge="1" parent="1" source="domain-cal" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6a400;dashed=1;endArrow=open;fontSize=9;fontColor=#d6a400;" target="ensemble" value="domain weights">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="435" y="745" />
              <mxPoint x="435" y="510" />
              <mxPoint x="865" y="510" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e-threshadapt-entropy" edge="1" parent="1" source="thresh-adapt" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6a400;dashed=1;endArrow=open;fontSize=9;fontColor=#d6a400;" target="entropy" value="τ per domain">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="840" y="745" />
              <mxPoint x="840" y="500" />
              <mxPoint x="705" y="500" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e-promptev-fore" edge="1" parent="1" source="prompt-ev" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6a400;dashed=1;endArrow=open;fontSize=9;fontColor=#d6a400;" target="forecaster" value="active prompt">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="635" y="745" />
              <mxPoint x="550" y="745" />
              <mxPoint x="550" y="435" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-bg" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#cccccc;" value="" vertex="1">
          <mxGeometry height="180" width="280" x="1150" y="200" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontStyle=1;" value="Legend" vertex="1">
          <mxGeometry height="20" width="260" x="1160" y="208" as="geometry" />
        </mxCell>
        <mxCell id="legend-solid" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=10;" value="— Data flow" vertex="1">
          <mxGeometry height="20" width="240" x="1180" y="230" as="geometry" />
        </mxCell>
        <mxCell id="legend-dashed" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=10;" value="- - Scheduler trigger" vertex="1">
          <mxGeometry height="20" width="240" x="1180" y="252" as="geometry" />
        </mxCell>
        <mxCell id="legend-feedback" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=10;fontColor=#d6a400;" value="- - Feedback (weights/prompts)" vertex="1">
          <mxGeometry height="20" width="240" x="1180" y="274" as="geometry" />
        </mxCell>
        <mxCell id="legend-paper" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=10;fontColor=#ae4132;" value="★ paper_mode=True by default" vertex="1">
          <mxGeometry height="20" width="240" x="1180" y="296" as="geometry" />
        </mxCell>
        <mxCell id="legend-db-note" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=10;fontColor=#23769c;" value="→ All reads/writes via db/store.py" vertex="1">
          <mxGeometry height="20" width="240" x="1180" y="318" as="geometry" />
        </mxCell>
        <mxCell id="legend-entropy-note" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=10;" value="τ entropy threshold default = 4.0 bits" vertex="1">
          <mxGeometry height="20" width="240" x="1180" y="340" as="geometry" />
        </mxCell>
        <mxCell id="legend-kelly-note" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=10;" value="Kelly: 25% fractional, 5% bankroll cap" vertex="1">
          <mxGeometry height="20" width="240" x="1180" y="358" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
